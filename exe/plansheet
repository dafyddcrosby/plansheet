#!/usr/bin/env ruby
# frozen_string_literal: true

require "plansheet"
require "optparse"

parser = OptionParser.new
parser.on(
  "--sheet",
  "Generates MD/LaTeX project PDF"
)
parser.on(
  "--sort",
  "Sort project files"
)
parser.on(
  "--cli",
  "CLI dump of projects (WIP)"
)
parser.on(
  "--location_filter LOCATION",
  "location filter for CLI dump (WIP)"
)
options = {}
parser.parse!(into: options)

config = Plansheet.load_config

if options[:sheet] || options.empty?
  project_arr = Plansheet.load_projects_dir config["projects_dir"]

  Dir.mkdir config["output_dir"] unless Dir.exist? config["output_dir"]

  Plansheet::Sheet.new("#{config["output_dir"]}/projects.md", project_arr)
elsif options[:sort]
  Plansheet.resort_projects_in_dir config["projects_dir"]
elsif options[:cli]
  project_arr = Plansheet.load_projects_dir config["projects_dir"]
  project_arr.sort!
  project_arr.delete_if {|x| x.status == "dropped" || x.status == "done" }
  project_arr.select! {|x| x.location == options[:location_filter]} if options[:location_filter]
  project_arr.each do |proj|
    puts proj
    puts "\n"
  end
end
